======================================================================================================================
DESCRIPTION:

MB-46215 Event log module.

The module has:
1) Validators for mandatory attributes of the event log.
2) Event log builders and related functions.
2) API's to add event logs from ns_cluster.

Change-Id: I50c6a9dab02a56a0aa8c1c4e5981f4dcfe4d9800

======================================================================================================================
COMMENTS
======================================================================================================================
Author: Hareen Kancharla
Date: 2021-08-31 04:42:22.000000000
Message: 
Uploaded patch set 3: New patch set was added with same tree, parent, and commit message as Patch Set 2.
----------------------------------------------------------------------------------------------------------------------
Author: Build Bot
Date: 2021-08-31 04:42:45.000000000
Message: 
Patch Set 3: -Well-Formed

Build Started http://cv.jenkins.couchbase.com/job/ns-server-test/25398/
----------------------------------------------------------------------------------------------------------------------
Author: Build Bot
Date: 2021-08-31 04:49:29.000000000
Message: 
Patch Set 3: Well-Formed+1

Build Successful 

http://cv.jenkins.couchbase.com/job/ns-server-test/25398/ : SUCCESS
----------------------------------------------------------------------------------------------------------------------
Author: Hareen Kancharla
Date: 2021-08-31 17:53:28.000000000
Message: 
Topic set to event-logs
----------------------------------------------------------------------------------------------------------------------
Author: Hareen Kancharla
Date: 2021-08-31 17:55:03.000000000
Message: 
Patch Set 3: Verified+1
----------------------------------------------------------------------------------------------------------------------
Author: Artem Stemkovski
Date: 2021-09-03 00:38:11.000000000
Message: 
Patch Set 3:

(1 comment)

Overall stuff in ns_cluster.erl warrants separate commit with informative commit message
Line:1399, src/ns_cluster.erl -> Why did you delete this?

----------------------------------------------------------------------------------------------------------------------
Author: Artem Stemkovski
Date: 2021-09-03 01:05:32.000000000
Message: 
Patch Set 3:

(7 comments)
Line:22, src/event_log.erl -> not used outside of the module. should not be exported

Line:32, src/event_log.erl -> maybe we should use the same id's as in the old log, just in case if somebody cares?

Line:43, src/event_log.erl -> You use jsonify on the first element of the list but not on the second, which is quite strange. I think simply doing [{A, B}, {C, D}] will be much less confusing.

Line:104, src/event_log.erl -> This is not needed. Just pass fun is_valid_event_id/2 to validate_relative

Line:118, src/event_log.erl -> fun is_valid_event_id/2

Line:168, src/event_log.erl -> It is wasteful, considering that all that goes to add_log is generated by our own code

Line:196, src/event_log.erl -> wrong order of commits. this module is not available yet. basically after this commit add node functionality will be broken

----------------------------------------------------------------------------------------------------------------------
Author: Hareen Kancharla
Date: 2021-09-07 17:38:19.000000000
Message: 
Patch Set 3:

(8 comments)
Line:22, src/event_log.erl -> Ack. Will remove them.

Line:32, src/event_log.erl -> We had ids starting at 0 for each sub component (ns_cluster etc) in ns_log .. we wouldn't be able to maintain the same ids across components. We'll have to have a flat list of numbers starting at 0 like the audit_ids.

Line:43, src/event_log.erl -> Makes sense. I wanted to have a wrapper where I convert the Values to binaries when they are lists. Will uniformly use jsonify at all the places in the new patch.

Line:104, src/event_log.erl -> Ah Thanks. Changed it in the new patch.

Line:118, src/event_log.erl -> Ack

Line:168, src/event_log.erl -> Ack. Removed it in the new patch-set.

Line:196, src/event_log.erl -> Ack

Line:1399, src/ns_cluster.erl -> We add this log and subsequently delete all the ns_logs from this node since it is joining a new cluster, therefore removed it.

----------------------------------------------------------------------------------------------------------------------
Author: Hareen Kancharla
Date: 2021-09-07 17:40:13.000000000
Message: 
Abandoned

Opened a new review with the review comments. The services want to test their changes. Commit a modified version of this patch for them to make progress.
----------------------------------------------------------------------------------------------------------------------
