======================================================================================================================
DESCRIPTION:

Direct cast to ns_rebalance_observer for rebalance events.

Doing a cast to ns_rebalance_observer for interested events instead of the bunny
hop from master_activity_events_ingress to master_activity_events to cast in
ns_rebalance_observer as was done previously, to prevent delays as much as
possible. This is extremely ugly but effective and easy to maintain.

Change-Id: Icb3ae2df34c3f864b00d8f23223c7e20a8dae546

======================================================================================================================
COMMENTS
======================================================================================================================
Author: Aliaksey Artamonau
Date: 2019-02-20 22:39:36.000000000
Message: 
Uploaded patch set 2: Patch Set 1 was rebased.
----------------------------------------------------------------------------------------------------------------------
Author: Build Bot
Date: 2019-02-20 22:39:43.000000000
Message: 
Patch Set 2: -Well-Formed

Build Started http://cv.jenkins.couchbase.com/job/ns-server-test/8562/
----------------------------------------------------------------------------------------------------------------------
Author: Build Bot
Date: 2019-02-20 22:49:21.000000000
Message: 
Patch Set 2: Well-Formed+1

Permission granted to commit to restricted branch
----------------------------------------------------------------------------------------------------------------------
Author: Aliaksey Artamonau
Date: 2019-02-25 23:45:12.000000000
Message: 
Patch Set 2:

(7 comments)
Line:12, /COMMIT_MSG -> Too wide.

Line:123, src/master_activity_events.erl -> The point of this is to offload the computation from the caller: master events are supposed to be as light as possible on the submitter. I'd like to preserve this property.

Line:80, src/master_activity_events.erl -> This has no place here.

Line:81, src/master_activity_events.erl -> The point of the timestamper process is to give consistent timestamps to the events (later events have later timestamps). You can't correlate timestamps coming from different nodes. You need to generate your own timestamp in ns_rebalance_observer probably.

Line:111, src/ns_rebalance_observer.erl -> I'd suggest a bit more descriptive name. Maybe submit_master_event or something like that.

Line:112, src/ns_rebalance_observer.erl -> I think I'd prefer this being done in the ns_rebalance_observer context. Because now we're suddenly slowing down all sorts of processes that submit any master activity events.

Line:116, src/ns_rebalance_observer.erl -> I'd want this avoid "global" name resolution and use regular erlang name registration. The reason being:

1. This module will operate correctly only if all the events it's handling are generated by the leader node itself. So using local name will guarantee that that's indeed the case. And if somebody tries handling non-local event, that will be caught sooner rather than later.

2. Some of these events are generated outside rebalance. I don't want them to degrade because they need to be perform global name resolution just to find out that the process doesn't exist.

So I'd suggest registering the observer process under local name too and using it here.

----------------------------------------------------------------------------------------------------------------------
Author: Abhijeeth Nuthan
Date: 2019-03-01 00:42:15.000000000
Message: 
Patch Set 2:

(7 comments)
Line:12, /COMMIT_MSG -> Done

Line:123, src/master_activity_events.erl -> Done

Line:80, src/master_activity_events.erl -> Done

Line:81, src/master_activity_events.erl -> Done

Line:111, src/ns_rebalance_observer.erl -> Done

Line:112, src/ns_rebalance_observer.erl -> Done

Line:116, src/ns_rebalance_observer.erl -> Done

----------------------------------------------------------------------------------------------------------------------
