======================================================================================================================
DESCRIPTION:

MB-18530: erl: ability to truncate log messages

Change-Id: I180fb78ac676a53c6a158c28be5c14be0ccd5406

======================================================================================================================
COMMENTS
======================================================================================================================
Author: Pavel Blagodov
Date: 2016-04-29 14:21:35.000000000
Message: 
Uploaded patch set 1.
----------------------------------------------------------------------------------------------------------------------
Author: Pavel Blagodov
Date: 2016-04-29 14:36:17.000000000
Message: 
Patch Set 1: Code-Review+1 Verified+1
----------------------------------------------------------------------------------------------------------------------
Author: Anders Nygren
Date: 2016-04-29 15:30:54.000000000
Message: 
Patch Set 1:

(3 comments)
Line:246, src/menelaus_alert.erl -> This does two copies of the data. Use lists:flatten instead.
Move this into the true branch and use lists:flatlength instead of string:len, to avoid flattening if truncation is not needed.

Line:247, src/menelaus_alert.erl -> This works, (by accident), because in erlang boolean > integer. It would be better to have a separate function clause for TruncateLength=false, to make this clear, and avoid checking the length when it is not needed.

Line:249, src/menelaus_alert.erl -> Pedantic, avoid using ++, it copies the first argument. In this case since the result will be converted to binary later, just make 
[string:substr(....) | "..."]
This avoids the copying.

----------------------------------------------------------------------------------------------------------------------
Author: Pavel Blagodov
Date: 2016-04-29 16:16:27.000000000
Message: 
Patch Set 1:

(2 comments)
Line:246, src/menelaus_alert.erl -> S = [<<"some message">>].
I have tried but looks like lists:flatten works only for strings.

Line:247, src/menelaus_alert.erl -> binary_to_list(list_to_binary([<<"Cccc">>])) -> "Cccc". Why you think that string:len(BinArrToStr) is boolean?

----------------------------------------------------------------------------------------------------------------------
Author: Aliaksey Artamonau
Date: 2016-04-29 17:07:23.000000000
Message: 
Patch Set 1:

What's the reason you want to do it on the server side?

Also, I'm not even sure we need to bother with these conflict messages. It's a result of a problem in ns_config replication, that needs to be fixed.
----------------------------------------------------------------------------------------------------------------------
Author: Anders Nygren
Date: 2016-04-29 17:08:55.000000000
Message: 
Patch Set 1:

(2 comments)
Line:246, src/menelaus_alert.erl -> How can S contain a binary? It is generated by io_lib:format, that returns a deep list of chars.
To be clear I meant replace binary_yo_list(list_to_binary(S) with lists:flatten(S).

Line:247, src/menelaus_alert.erl -> Sorry I was unclear, it is TruncateLength that can be false

----------------------------------------------------------------------------------------------------------------------
Author: Pavel Blagodov
Date: 2016-05-01 19:08:26.000000000
Message: 
Patch Set 1:

Aliaksey, it could be useful to keep full error messages in database (maybe for collect logs) but we still need to truncate them for UI. Additionally we may have some very long errors not from UI.
----------------------------------------------------------------------------------------------------------------------
Author: Pavel Blagodov
Date: 2016-05-01 19:49:19.000000000
Message: 
Patch Set 1:

(2 comments)
Line:246, src/menelaus_alert.erl -> I got your point but please believe me or see for yourself S contains a binary.

Line:247, src/menelaus_alert.erl -> TruncateLength can't be false here because of L244

----------------------------------------------------------------------------------------------------------------------
Author: Anders Nygren
Date: 2016-05-01 21:42:26.000000000
Message: 
Patch Set 1:

(1 comment)
Line:247, src/menelaus_alert.erl -> sorry, I missed that.

----------------------------------------------------------------------------------------------------------------------
