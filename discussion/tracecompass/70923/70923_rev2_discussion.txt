======================================================================================================================
DESCRIPTION:

LTTng-Analyses integration

This patch introduces a new "analysis.lami" plugin, which contains
generic support for any analysis implementing the LAMI protocol [1],
as well as integration with the current LTTng-Analyses.

If LTTng-Analyses are present on the user's system (and on the $PATH),
options under the "External Analyses" trace sub-tree element become
available. Right-clicking on those allows running the specified
analysis, and will import the results as Reports in Trace Compass.

Reports are opened automatically when created, and will initially
display a table of the results returned by the external analysis.
The toolbar menu can then be used to generate charts from this data,
either Histograms or XY scatter plots.

Clicking on chart elements highlights the corresponding column in the
table, and vice versa. Also, if the data table rows contain a time
range or timestamp, integration via standard time selection signal
is done.

To not commit to final APIs yet, we've used the "internal.provisional"
naming, as described in [2].

Full user documentation and additional unit tests will follow.

Current limitations:
- The RunAnalysisHandler and others are specific to LAMI analyses,
  which means other types of OndemandAnalyses would have to define
  their own way of being started (which may not even be through
  a right-click menu option).

[1] https://github.com/lttng/lttng-analyses/blob/master/doc/mi.md
[2] https://wiki.eclipse.org/Provisional_API_Guidelines

Change-Id: I3cee70f20347ed2c71f077d40117073aeaf4161d
Signed-off-by: Alexandre Montplaisir <alexmonthy@efficios.com>
Signed-off-by: Michael Jeanson <mjeanson@efficios.com>
Signed-off-by: Jonathan Rajotte <jonathan.rajotte-julien@efficios.com>
Signed-off-by: Philippe Proulx <pproulx@efficios.com>

======================================================================================================================
COMMENTS
======================================================================================================================
Author: Alexandre Montplaisir
Date: 2016-04-19 18:45:07.000000000
Message: 
Patch Set 2: Published edit on patch set 1
----------------------------------------------------------------------------------------------------------------------
Author: CI Bot
Date: 2016-04-19 19:22:32.000000000
Message: 
Patch Set 2:

Build Started https://hudson.eclipse.org/tracecompass/job/tracecompass-gerrit/7907/
----------------------------------------------------------------------------------------------------------------------
Author: CI Bot
Date: 2016-04-19 20:03:33.000000000
Message: 
Patch Set 2: Code-Review+1

Build Successful 

https://hudson.eclipse.org/tracecompass/job/tracecompass-gerrit/7907/ : SUCCESS
----------------------------------------------------------------------------------------------------------------------
Author: Matthew Khouzam
Date: 2016-04-22 00:59:27.000000000
Message: 
Patch Set 2:

Asking: this is 10kloc in a single commit. Are you sure you wouldn't rather split it up a bit?
----------------------------------------------------------------------------------------------------------------------
Author: Genevieve Bastien
Date: 2016-04-22 20:08:55.000000000
Message: 
Patch Set 2:

+1 for splitting

Suggestion:

* the new empty projects with Activator: removes a lot of noise
* Changes to core classes: they should not depend on .lami anyway
* Core stuff: can be split further?
* UI stuff: can be split further?
* lttng-specific stuff

Splitting has the advantage that each patch can be more thoroughly reviewed, requires less time (so may be reviewed more often), and we can "get rid of them" by submitting them as they are ready.
----------------------------------------------------------------------------------------------------------------------
Author: Alexandre Montplaisir
Date: 2016-04-22 22:05:26.000000000
Message: 
Patch Set 2:

Yes of course, this is quite the patch at the moment. However we're still working on it, so things are still changing. I'm thinking of doing a proper split once we have most of our stuff in, or this becomes the very next patch in the branch to review, whichever comes first.

Even the new plugins, I still need to add a .tests one, Michael is working on some tests at the moment... Once I have that done I will at least push the empty plugins!
----------------------------------------------------------------------------------------------------------------------
Author: Bernd Hufmann
Date: 2016-04-25 14:05:04.000000000
Message: 
Patch Set 2: Code-Review-1

(1 comment)

Finally, I had time to try it out. It's a very nice addition for Trace Compass.

I noticed a few things which I will bring up below even if the fixes might be in dependent patches. 

Please note that I didn't do a full review. I was testing the feature. A full review will be done by a colleague or by me later on.

1) The user has multiple traces open (kernelA and ustA). ustA is the active trace. User selects a time range for the active trace (ustA). Then user right-mouse clicks on one of the LTTng Analyses of kernel and selects the RunCommand entry. When running the analyses an error dialog will open "The script terminated abnormally. Error: could not find kernel directory". This seems to be intermittent (unfortunately). It seems, that something is not initialized sometimes.

2) The user has multiple traces open (kernelA and kernelB). kernelA is the active trace. User selects a time range for the active trace (kernelB). Then user right-mouse clicks on one of the LTTng Analyses of kernel and selects the RunCommand entry. The on-demand analysis seems to run fine. But there now way to know for which trace the analysis was actually run. The table doesn't show this nor the custom views (unless I'm missing something). I needs to be obvious for the user which view is for which trace.

3) I think the "Views" folder needs to be on top of the "External Analysis" and "Reports". The order should be 
"Views", "External-Analysis" and "Reports". I think it would be natural, because the user will first open a trace, then open a view, select a time range in the relevant view and then run the external analysis. There is a simple solution for this: rename the "Views" folder to "Built-in Analyses" and then it will be automatically because folders are by default on top of files (=traces) and they are ordered alphabetically. 

4) I removed one of the scripts. Then the respective analysis was strike-through. But the Run-Command was still enabled and could be triggered. After running it an error message was shown indicating that the command was not enabled.
Line:9, analysis/org.eclipse.tracecompass.analysis.lami.ui/plugin.xml -> This command was visible when right mouse-click on the "Views" project element. To avoid this you need also to implement "visibleWhen" to make sure that it's only shown when the selection is a TmfOndemandAnalysisElement.

----------------------------------------------------------------------------------------------------------------------
Author: Genevieve Bastien
Date: 2016-04-25 20:44:30.000000000
Message: 
Patch Set 2: Code-Review-1

Some comments while reviewing:

1- First trace I opened there was no external analysis. I had to debug to realize it was not lttng 2.7, that's why they didn't show. Either show them striken out or have a help text.

2- Why are on demand analyses completely on the side of the other IAnalysisModule. Can there be re-use of some concepts there? Would it be beneficial?

3- Opening reports open many views that are not obviously linked (and the user sees only one of them). It would be preferable to open only 1 view with multiple tabs.

4- When running the analysis, --begin and --end could be pre-populated in the extra parameters instead of the base command, so the user knows they are extra parameters that can be edited.

5- When the same command is run on the same trace, it creates multiple reports named "command [#x]". Could it save the command line options, or let us name the report in the run dialog or give us an indication of what the difference is.
----------------------------------------------------------------------------------------------------------------------
Author: Genevieve Bastien
Date: 2016-04-26 01:25:06.000000000
Message: 
Patch Set 2:

>  When running the analyses an error dialog will open "The script terminated abnormally. Error: could not find kernel directory". This seems to be intermittent (unfortunately). It seems, that something is not initialized sometimes.

If like me you have the habit of renaming your 'kernel' folders to something else, then you'll see this message (also probably with ust traces) because that's the output of the script itself. It looks for a folder named 'kernel' that contains the trace file. If it is not present, it shows the error.
----------------------------------------------------------------------------------------------------------------------
Author: Alexandre Montplaisir
Date: 2016-04-26 03:46:59.000000000
Message: 
Patch Set 2:

Thanks for trying it out Bernd! Your points 1,2,4 seem to be genuine bugs, I will try it out.

About point #3:

> I think it would be natural, because the user will first open a trace, then open a view, select a time range in the relevant view and then run the external analysis

I would argue the opposite! The LTTng-Analyses are a nice way of getting high-level information and statistics from a trace. An envisageable workflow would be to first run a general analysis on the whole trace, which will present interesting time ranges. Then the user, using these time ranges, can drill into the more specific views like CFV/RV which are only useful when zoomed in a lot.

Some views are open by default, deciding which ones is very important too. Perhaps things like CPU usage and memory usage should be visible too.
----------------------------------------------------------------------------------------------------------------------
Author: Alexandre Montplaisir
Date: 2016-04-26 03:54:54.000000000
Message: 
Patch Set 2:

> 1- First trace I opened there was no external analysis. I had to debug to realize it was not lttng 2.7, that's why they didn't show. Either show them striken out or have a help text.

As we discussed today, this is due to the appliesTo() and canRun() checks. It would be easy to change. Perhaps only show them for kernel traces, but if it's LTTng <2.7, do show it but strike it out?

> 2- Why are on demand analyses completely on the side of the other IAnalysisModule. Can there be re-use of some concepts there? Would it be beneficial?

There are some things in common, but many things not in common, which is why I didn't go straight to extending IAnalysisModule. But maybe there is some integration that could be done in the future, especially if these start using IAnalysisRequirement and such.

> 3- Opening reports open many views that are not obviously linked (and the user sees only one of them). It would be preferable to open only 1 view with multiple tabs.

I agree, I like that idea. It would also make the Report element match a single view, which is the case for the Views elements already.

> 4- When running the analysis, --begin and --end could be pre-populated in the extra parameters instead of the base command, so the user knows they are extra parameters that can be edited.

The command is shown for informative purposes. There wouldn't be much point in editing these timestamps by hand, since those are the raw values, and hardly mean anything to the user. I'm not sure it would be very helpful, but could be done if we want to.

> 5- When the same command is run on the same trace, it creates multiple reports named "command [#x]". Could it save the command line options, or let us name the report in the run dialog or give us an indication of what the difference is.

The report itself has most of this information, it just isn't really exposed in the UI at the moment. So many things to do, so little time! But yes, showing these things in the properties views for example would be really nice.
----------------------------------------------------------------------------------------------------------------------
Author: Alexandre Montplaisir
Date: 2016-04-26 21:54:53.000000000
Message: 
Patch Set 2: Code-Review-1

I'm working on splitting this huge commit in smaller ones atm.

Also it currently won't work with the new branch I pushed earlier, because the element is now called OnDemandAnalysisElement (with a capital D), so the menu won't appear at all...
----------------------------------------------------------------------------------------------------------------------
Author: Patrick Tasse
Date: 2016-04-26 22:52:59.000000000
Message: 
Patch Set 2: Code-Review-1

(71 comments)
Line:5, analysis/org.eclipse.tracecompass.analysis.lami.core/META-INF/MANIFEST.MF -> I've been told that our plug-in versions are all independent of the Trace Compass and feature versions now, so should this be 1.0.0? See for example o.e.t.segmentstore.core.

Line:14, analysis/org.eclipse.tracecompass.analysis.lami.core/plugin.properties -> These are unused

Line:2, analysis/org.eclipse.tracecompass.analysis.lami.core/src/org/eclipse/tracecompass/internal/analysis/lami/core/Activator.java -> not yet

Line:2, analysis/org.eclipse.tracecompass.analysis.lami.core/src/org/eclipse/tracecompass/internal/analysis/lami/core/package-info.java -> EfficiOS?

Line:392, analysis/org.eclipse.tracecompass.analysis.lami.core/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/core/module/LamiAnalysis.java -> It could be helpful if the trace path would be surrounded with quotes, then we could safely copy and paste the command from the Run External Analysis dialog to the command line (it fails if there are spaces somewhere in the path).

Line:463, analysis/org.eclipse.tracecompass.analysis.lami.core/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/core/module/LamiAnalysis.java -> Remove eventually?

Line:533, analysis/org.eclipse.tracecompass.analysis.lami.core/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/core/module/LamiAnalysis.java -> Is this output supposed to be persisted? After a restart all the Reports elements are empty in the Project Explorer.

Line:620, analysis/org.eclipse.tracecompass.analysis.lami.core/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/core/module/LamiAnalysis.java -> Is this OK to be not yet implemented for now?

Line:692, analysis/org.eclipse.tracecompass.analysis.lami.core/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/core/module/LamiAnalysis.java -> remove

Line:733, analysis/org.eclipse.tracecompass.analysis.lami.core/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/core/module/LamiAnalysis.java -> remove?

Line:2, analysis/org.eclipse.tracecompass.analysis.lami.core/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/core/module/LamiAnalysisReport.java -> I've seen 'inc' 'inc.' and 'Inc.', maybe you want to make it consistent

Line:2, analysis/org.eclipse.tracecompass.analysis.lami.core/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/core/module/LamiTimeStampFormat.java -> check others?

Line:2, analysis/org.eclipse.tracecompass.analysis.lami.core/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/core/module/messages.properties -> check others?

Line:29, analysis/org.eclipse.tracecompass.analysis.lami.core/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/core/types/LamiBoolean.java -> Surprised that it doesn't print as true/false, is this due to specifications?

Line:26, analysis/org.eclipse.tracecompass.analysis.lami.core/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/core/types/LamiNumber.java -> Could this assumption cause problems (e.g. all small numbers output as 0.00?)

File Comment: analysis/org.eclipse.tracecompass.analysis.lami.core/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/core/types/package-info.java -> There are lots of missing Javadoc in the classes of this package.
Line:5, analysis/org.eclipse.tracecompass.analysis.lami.ui/META-INF/MANIFEST.MF -> 1.0.0?

Line:2, analysis/org.eclipse.tracecompass.analysis.lami.ui/build.properties -> check others?

Line:29, analysis/org.eclipse.tracecompass.analysis.lami.ui/plugin.xml -> Might want to put ifEmpty=false since there is no check on the count, and for "and" operator it defaults to true if empty.

Line:43, analysis/org.eclipse.tracecompass.analysis.lami.ui/plugin.xml -> Might want to put ifEmpty=false since there is no check on the count, and for "and" operator it defaults to true if empty.

Line:148, analysis/org.eclipse.tracecompass.analysis.lami.ui/plugin.xml -> After an Eclipse restart, the views are restored but they are empty. Until the report can be persisted, the view should not be marked as restorable.

I'm not sure how we can restore the 'input' of a view, perhaps only through a specifically formatted secondary ID ?

Line:41, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/handler/DeleteReportHandler.java -> Maybe we can just assume that the plugin.xml conditions have done their job correctly? See below for the selection.

Line:82, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/handler/DeleteReportHandler.java -> Lately, we try to use HandlerUtil from execute() to get the selection, instead of storing it in isEnabled(). You might want to consider changing to that. Applies to the other handlers as well.

File Comment: analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/handler/OpenReportHandler.java -> It would be nice if double-clicking or pressing Enter on a report would open it. Maybe this can be done with a global action handler.
Line:2, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/handler/ParameterDialog.java -> Is this class copied from somewhere else? Maybe it should be described.

Line:209, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/handler/ParameterDialog.java -> Version from another plug-in?

Line:233, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/handler/ParameterDialog.java -> Version from another plug-in?

File Comment: analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/handler/RunAnalysisHandler.java -> It would be nice if double-clicking or pressing Enter on an external analysis would run it. Maybe this can be done with a global action handler.
Line:82, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/viewers/LamiHistogramViewer.java -> I ran the Syscall Stats analysis and from the Per-TID system call statistics view, I tried to do a histogram of Total system call count (calls) per Process (name).

I expected all table entries with the same Process (name) to be grouped together in the histogram, instead every table row maps to a separate x-value, so there are duplicate x-labels.

Line:144, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/viewers/LamiHistogramViewer.java -> You should already be registered due to base class.

Line:162, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/viewers/LamiHistogramViewer.java -> f

Line:162, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/viewers/LamiHistogramViewer.java -> find

Line:163, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/viewers/LamiHistogramViewer.java -> fResultTable

Line:164, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/viewers/LamiHistogramViewer.java -> corresponds to

Line:220, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/viewers/LamiHistogramViewer.java -> that should not be possible?

Line:293, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/viewers/LamiHistogramViewer.java -> Maybe let the base class handle this.

Line:294, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/viewers/LamiHistogramViewer.java -> super.dispose() takes care of this.

Line:295, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/viewers/LamiHistogramViewer.java -> This cleanup should be done in a DisposeListener added to the viewer's Control in the constructor.

Line:124, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/viewers/LamiScatterViewer.java -> From IO Log Report -> I/O operations log, I tried to do a scatter chart with Read/write size as the x-series.

I got a NumberFormatException (empty String), the chart is empty and it cannot be cleared from the view menu.

Even though the aspect is numerical, some values are empty so should not be plotted. I don't think they should plot to zero either?

Line:164, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/viewers/LamiScatterViewer.java -> Done by the base class.

Line:258, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/viewers/LamiScatterViewer.java -> Maybe let the base class handle this.

Line:259, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/viewers/LamiScatterViewer.java -> super.dispose() does this.

Line:260, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/viewers/LamiScatterViewer.java -> This cleanup should be done in a DisposeListener added to the viewer's Control in the constructor.

Line:121, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/viewers/LamiTableViewer.java -> Done by the base class.

Line:225, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/viewers/LamiTableViewer.java -> remove?

Line:229, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/viewers/LamiTableViewer.java -> May want to dispose the table viewer's Control in case this is called programmatically.

Line:230, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/viewers/LamiTableViewer.java -> super.dispose() does this.

Line:231, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/viewers/LamiTableViewer.java -> This cleanup should be done in a DisposeListener added to the viewer's Control in the constructor.

Line:169, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/viewers/LamiXYChartViewer.java -> With one XY chart the legend can easily take 50% of horizontal space. With two or more XY charts it can take all of the space leaving nothing for the graph (depending on perspective layout, window size, etc.).

Perhaps it would be better if the legend was above or below the graph? Or if it could be easily hidden?

Line:264, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/viewers/LamiXYChartViewer.java -> Because it's a public method, it could be called programmatically to trigger a dispose of the viewer. In that case the right thing to do is to dispose the chart.

The (super) cleanup, however, should not be done in this method since it is not guaranteed that the method ever gets called. So the super.dispose() should be called from a DisposeListener added to the chart widget in the constructor.

Line:27, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/views/LamiAxisListDialog.java -> fCheckBoxOptions

Line:58, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/views/LamiAxisListDialog.java -> It's a bit strange to store the Button in the model.

You could add a selection listener to the Button that would immediately write the new value in the option when the button selection is changed.

Line:90, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/views/LamiAxisListDialog.java -> The returned model could be a map <String,Boolean> (option name -> value), then the caller wouldn't need to keep track of each option index.

Line:28, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/views/LamiAxisListSelectionDialog.java -> fCheckBoxOptions

Line:72, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/views/LamiAxisListSelectionDialog.java -> Would it be better to have all list elements selected by default? For NewChartAction that would mean all columns/series initially selected.

Line:77, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/views/LamiAxisListSelectionDialog.java -> Would it be better to ensure that OK button is disabled if there is no list element selected? Otherwise it creates an empty graph.

Line:94, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/views/LamiAxisListSelectionDialog.java -> spaces

Line:88, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/views/LamiReportView.java -> Being a subclass of TmfView, you are already registered to the signal manager.

Line:122, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/views/LamiReportView.java -> sigh

Line:161, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/views/LamiReportView.java -> A view never needs to call dispose on its controls, it is done by the platform.

Line:166, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/views/LamiReportView.java -> I'm not sure this interface is needed. A viewer should clean itself up by adding a DisposeListener to its Control.

Line:168, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/views/LamiReportView.java -> The super.dispose() took care of this.

Line:57, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/views/LamiReportViewFactory.java -> When you give focus to the first report view, somehow the Project Explorer view seems to lose focus in an incorrect way. Clicking or right-clicking on the Project Explorer tree does not give back focus to the view (it normally does when the focus was lost non-programmatically).

This has bad consequences... the context menu in Project Explorer gets 'stuck' on disabled LAMI commands even when clicking on unrelated elements (e.g. Trace element), until the Project View is given focus again some other way.

It seems that this could be a Platform bug, but you should see if there is a workaround, maybe by activating the view a different way, otherwise maybe not activating the view at all?

Line:60, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/views/LamiReportViewFactory.java -> When repeatedly opening the same reports, the views get duplicated.

I was able to keep the views by using a combination of the report's hash code and the table's hash code as a secondary ID. Then also if you close a few of the report views, opening the report again brings those back and keeps the ones that were still open.

Hash code is not guaranteed to be unique though, and it won't work correctly if there are new instances created for the same report or same table (but it doesn't seem to be the case).

Line:113, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/views/LamiViewerControl.java -> Maybe this is not needed?

Line:46, lttng/org.eclipse.tracecompass.lttng2.kernel.core/plugin.xml -> might want to use named id's?

File Comment: lttng/org.eclipse.tracecompass.lttng2.kernel.core/src/org/eclipse/tracecompass/internal/lttng2/kernel/core/analysis/ondemand/lttnganalyses/LttngCpuTopAnalysis.java -> I run this on a trace, some of the process names come back as empty string from the script.

If I try to make a histogram chart with the process name as x-series, I get an IllegalArgumentException when the SWTChart tries to draw the empty string rotated at a 90 degree angle. SWTChart doesn't like empty x-series labels that have a string extent width of 0.
File Comment: lttng/org.eclipse.tracecompass.lttng2.kernel.core/src/org/eclipse/tracecompass/internal/lttng2/kernel/core/analysis/ondemand/lttnganalyses/LttngSchedFreqAnalysis.java -> This analysis always fails for the trace I try it on. "No results were returned". Is there a way for the user to have information why?
File Comment: lttng/org.eclipse.tracecompass.lttng2.kernel.core/src/org/eclipse/tracecompass/internal/lttng2/kernel/core/analysis/ondemand/lttnganalyses/LttngSyscallStatsAnalysis.java -> This analysis report opens many dozens of views. Do you see any alternatives?
Line:53, lttng/org.eclipse.tracecompass.lttng2.kernel/feature.xml -> trailing whitespace

Line:89, tmf/org.eclipse.tracecompass.tmf.ui/src/org/eclipse/tracecompass/tmf/ui/project/model/TmfReportsElement.java -> Perhaps loop from 2 and build the string every time instead of replacing? Might be simpler.

----------------------------------------------------------------------------------------------------------------------
Author: Jonathan Rajotte Julien
Date: 2016-04-26 23:50:00.000000000
Message: 
Patch Set 2:

(8 comments)

Thanks for the feedback
Line:82, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/viewers/LamiHistogramViewer.java -> It is extremely difficult to predict if data for histogram should be aggregated since this is fully custom. Since each x map to a row it make sense to display separated x value.

The valid histogram for this analysis since it is a per TID would have been to use the TID column as x-axis. Aggregating based on process name would should *false* informations. So using per-row value (event if there is duplicate) is the correct way to do it.

We let the user do it based on the assumptions that a user know what it want.

Line:220, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/viewers/LamiHistogramViewer.java -> Per definition of the paintListenner(paintControl) event can be null.

Or am I missing something ?

Line:124, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/viewers/LamiScatterViewer.java -> Good catch !

Returning zero for now would be the way to go but I agree that we might want to skip the graphing part if we can't map a valid  
numerical value.

Line:58, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/views/LamiAxisListDialog.java -> Well there is patches that work on the button state depending on the current selection so having the button in the model is a plus. Might want to review this once the dynamic dialog are merged in this patchSet.

Line:90, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/views/LamiAxisListDialog.java -> Good idea

Line:72, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/views/LamiAxisListSelectionDialog.java -> No since it make no sense to plot all value since most of them make no sense together / with the selected x axis. Also we want to add dynamic possible selection based on the type.

Line:77, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/views/LamiAxisListSelectionDialog.java -> Good point !

Line:122, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/views/LamiReportView.java -> ?

----------------------------------------------------------------------------------------------------------------------
Author: Alexandre Montplaisir
Date: 2016-04-27 02:00:55.000000000
Message: 
Patch Set 2:

(8 comments)

Thanks for the comments! I went through a few so far, I will finish tomorrow. Next push will have the commit split also.
Line:5, analysis/org.eclipse.tracecompass.analysis.lami.core/META-INF/MANIFEST.MF -> Ah yeah since it's a new plugin it could start at 1.0

Line:14, analysis/org.eclipse.tracecompass.analysis.lami.core/plugin.properties -> ah yeah those won't be needed anymore

Line:2, analysis/org.eclipse.tracecompass.analysis.lami.core/src/org/eclipse/tracecompass/internal/analysis/lami/core/Activator.java -> Some of these files were really authored in 2015! Which is why I left 2015 in many places.

Line:2, analysis/org.eclipse.tracecompass.analysis.lami.core/src/org/eclipse/tracecompass/internal/analysis/lami/core/package-info.java -> If I copy-paste a file, I don't get copyright on it :P

For these tiny files it doesn't really matter. < 10 lines is not copyrightable anyway.

Line:392, analysis/org.eclipse.tracecompass.analysis.lami.core/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/core/module/LamiAnalysis.java -> Good idea, however the quotes are shell specific. Some shells may use \ esacpes instead etc. I am not sure if we can get a solution that is more or less shell-agnostic?

Line:463, analysis/org.eclipse.tracecompass.analysis.lami.core/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/core/module/LamiAnalysis.java -> Yeah these should be logged (as info) instead.

Line:533, analysis/org.eclipse.tracecompass.analysis.lami.core/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/core/module/LamiAnalysis.java -> No, that is a main difference between On-Demand and "standard" analyses, on-demand ones are stateless with regards to the trace. This is why the execute method takes a trace, and then returns the corresponding results object. Each call to execute() is an independant execution.

The LamiAnalysis does have a bit of state though, which is done by running --metadata. But that state is independant from the trace.

The thing to be persisted are the reports themselves, which are specific to a given trace. Unfortunately we probably won't have time to implement persistence for Neon, so for now the reports are cleared after a restart. But that's definitely one of the top items for afterwards.

About the lingering views, that will be handled correctly when the reports are persisted. For now I would have preferred to automatically close the views, but due to how Eclipse workspaces are saved I don't think it's possible. If you know a way please let me know!

Line:620, analysis/org.eclipse.tracecompass.analysis.lami.core/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/core/module/LamiAnalysis.java -> I think it was not NYI in LTTng-Analyses when this was first written, which is why the result tables' time range are all 0,0 now. It should be working now, I'll update it.

We don't show it in the UI yet, but the table will have this information.

----------------------------------------------------------------------------------------------------------------------
Author: Alexandre Montplaisir
Date: 2016-04-27 19:21:27.000000000
Message: 
Patch Set 2:

(24 comments)
Line:392, analysis/org.eclipse.tracecompass.analysis.lami.core/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/core/module/LamiAnalysis.java -> I checked with a domain expert (kek) and double-quotes are kind-of standard, so we could add them here for convenience and it should work more or less everywhere.

Line:725, analysis/org.eclipse.tracecompass.analysis.lami.core/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/core/module/LamiAnalysis.java -> should catch NumberFormatException only

Line:733, analysis/org.eclipse.tracecompass.analysis.lami.core/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/core/module/LamiAnalysis.java -> I will move this to Activator.logInfo()

Line:2, analysis/org.eclipse.tracecompass.analysis.lami.core/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/core/module/LamiAnalysisReport.java -> It should be "EfficiOS Inc." thanks for pointing it out

Line:26, analysis/org.eclipse.tracecompass.analysis.lami.core/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/core/types/LamiNumber.java -> Good point, we had to check...

Actually, no LTTng-Analysis seem to return JSON doubles at the moment, so this will never be called. They do return ratio objects, a subclass of this one which also does %.2f. In that case it makes sense, so percentages are always with 2 decimals.

For generic numbers though, if we remove the formatter here, we will end up showing exactly what the analysis sends us, which seems like a good approach.

Line:9, analysis/org.eclipse.tracecompass.analysis.lami.ui/plugin.xml -> Thanks for your input guys, it's very helpful, I am not very familiar with Eclipse-provided extension points like these.

I will keep these in mind and fix them on a subsequent push, so that at least the split commits can be up on Gerrit, then I can test the changes.

Line:82, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/handler/DeleteReportHandler.java -> Ok, sounds good, since there's a lot of redundant checks like this...

Do you have an example of a handler that uses HandlerUtil?

Line:2, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/handler/ParameterDialog.java -> Yeah it's a copy of MessageDialog. The class javadoc should indicate this.

Line:209, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/handler/ParameterDialog.java -> Ah yes, these don't make sense here.

File Comment: analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/handler/RunAnalysisHandler.java -> Yep indeed, I've looked with GeneviÃ¨ve how to do this, hooking the openHandler should do it. I'll try to get that done.
Line:144, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/viewers/LamiHistogramViewer.java -> Ah yes, TmfComponent.init() should have registered us already.

Line:124, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/viewers/LamiScatterViewer.java -> The LamiGenericAspect should check if the values can be parsed to double or not. If not, they should return 0.

For numerical values "null" don't make much sense anyway, the analysis should always return a value like 0. We will check that with the L-A authors.

Line:169, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/viewers/LamiXYChartViewer.java -> SWTChart has tons of display quirks like that... We'll look into moving to something more modern at some point... (like d3 with embedded javascript) because it's extremely complex and time-consuming to obtain a result that looks good in all conditions.

Line:264, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/viewers/LamiXYChartViewer.java -> Isn't it cleaner to dispose explicitly the things we instantiate, than depending on DisposeListeners ? Like in a class with AutoCloseable fields does in its close() method.

Line:161, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/views/LamiReportView.java -> That's horrible

Line:57, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/views/LamiReportViewFactory.java -> Yeah I noticed that too, it does seem like a platform bug.

We tested not opening and focusing the view at all, and the experience is not great either. If there are no errors running the analysis, there is no popup at the end, so "nothing" happens when the analysis is ready. By focusing the new views it shows to the user that the analysis is done and results came in.

However with the upcoming change of putting all the views into one, and having tabs inside that view, the logic here will change a bit. We won't focus the first one, we will focus the only view, maybe the result will be different.

Line:60, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/views/LamiReportViewFactory.java -> It's fine to open the same reports multiple times, so the views should get duplicated. However indeed the experience is weird when one report contains several views. The upcoming tabs-in-view change should improve this.

Line:113, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/views/LamiViewerControl.java -> Right now, perhaps "fViewer" can get disposed automatically, but if we add more resources in here that don't get auto-disposed, we will want to add them in here too. So I think it's safer to keep the dispose() calls in the pevious class.

Line:46, lttng/org.eclipse.tracecompass.lttng2.kernel.core/plugin.xml -> We could, but there is really no point, the IDs are not used anywhere, unlike standard analyses. I thought leaving the pregenerated IDs helps indicating this.

File Comment: lttng/org.eclipse.tracecompass.lttng2.kernel.core/src/org/eclipse/tracecompass/internal/lttng2/kernel/core/analysis/ondemand/lttnganalyses/LttngCpuTopAnalysis.java -> I'll try this with our latest branch, I think that was fixed.
File Comment: lttng/org.eclipse.tracecompass.lttng2.kernel.core/src/org/eclipse/tracecompass/internal/lttng2/kernel/core/analysis/ondemand/lttnganalyses/LttngSchedFreqAnalysis.java -> The analysis makes use of the sched_waking event, which was introduced only in Linux 4.3. Traces of earlier kernel won't be able to show anything.

This is indeed a problem with the LTTng-Analyses, they don't really check for requirements or anything. We could add extra checks on our side (like with TmfAnalysisRequirements) but ideally this should be done on the analysis side.
File Comment: lttng/org.eclipse.tracecompass.lttng2.kernel.core/src/org/eclipse/tracecompass/internal/lttng2/kernel/core/analysis/ondemand/lttnganalyses/LttngSyscallStatsAnalysis.java -> Yeah, it gives one table per syscall. It's not great, but again it's the analysis' job to give useful tables. It could implement a command-line option to give multiple rows in one table instead of multiple tables, and we could pass that option along.
Line:53, lttng/org.eclipse.tracecompass.lttng2.kernel/feature.xml -> I'm lost when I'm not in the Eclipse editor!

Line:89, tmf/org.eclipse.tracecompass.tmf.ui/src/org/eclipse/tracecompass/tmf/ui/project/model/TmfReportsElement.java -> I can't seem to do it in a way that doesn't require 2-3 more internal variables. Do you have a suggestion?

Regex replace is not particularly efficient, but performance is not important here.

----------------------------------------------------------------------------------------------------------------------
Author: Alexandre Montplaisir
Date: 2016-04-27 22:11:39.000000000
Message: 
Patch Set 2: Code-Review-2

This has now been superseded by https://git.eclipse.org/r/#/c/71565/ and the commits around it. Some comments here are still valid, and will have to be fixed over there.
----------------------------------------------------------------------------------------------------------------------
Author: Patrick Tasse
Date: 2016-04-27 22:50:02.000000000
Message: 
Patch Set 2:

(19 comments)
Line:5, analysis/org.eclipse.tracecompass.analysis.lami.core/META-INF/MANIFEST.MF -> When did we decide that again? I feel I'm going to miss seeing a @since and not knowing which Trace Compass release it maps to. Oh well...

Line:2, analysis/org.eclipse.tracecompass.analysis.lami.core/src/org/eclipse/tracecompass/internal/analysis/lami/core/Activator.java -> OK, but I meant are there 'others' yet?

Line:533, analysis/org.eclipse.tracecompass.analysis.lami.core/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/core/module/LamiAnalysis.java -> OK for the persistence of Reports.

For the lingering views, restorable:false in the view extension in plugin.xml does the trick.

Line:733, analysis/org.eclipse.tracecompass.analysis.lami.core/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/core/module/LamiAnalysis.java -> Will that show on the console? It might be annoying, what do others think?

Line:82, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/handler/DeleteReportHandler.java -> CopyTraceHandler for example.

If you use the 'Checked' versions it does not return null but throws exception and fails execution instead.

Line:82, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/viewers/LamiHistogramViewer.java -> > The valid histogram for this analysis since it is a per TID would have been to use the TID column as x-axis. Aggregating based on process name would should *false* informations. So using per-row value (event if there is duplicate) is the correct way to do it.

I don't see how it would be false information if the count per process would be the sum of the count of all its threads.

In any case, if there's no aggregation of buckets or any assurance that the y-values are counts, it seems this viewer is rather just a 'bar chart' viewer. Whether it represents an histogram depends entirely on the analysis and the chosen series.

Which is OK as functionality, but perhaps the name is misleading.

Line:220, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/viewers/LamiHistogramViewer.java -> Well, from the platform point of view it's unconstrained but never null.

It's just here that you are unfortunately in a @NonNullByDefault context and you have to mark it @Nullable. I guess you can mark the method @NonNullByDefault({}) or live with the unnecessary null check.

Line:120, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/viewers/LamiScatterViewer.java -> Could be Math.max with a floor constant?

This is a bit arbitrary though, can we be sure there are no analysis that return small values between 0.0 and 1.0? For example a percentage in floating-point form...

Maybe zero should map to the minimum non-zero y-value (only if that happens to be below 1.0?)? Or just not plotted?

Line:124, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/viewers/LamiScatterViewer.java -> I still think that we should not plot missing values to zero, it might affect the axis range out of normal values for some analysis (kind of like when we have a timestamp that is 1970-01-01 in our time graphs...).

Line:133, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/viewers/LamiScatterViewer.java -> Has this been done? Is it the setLineSeriesColor() below?

Line:155, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/viewers/LamiScatterViewer.java -> really should be a declared constant...

Line:264, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/viewers/LamiXYChartViewer.java -> When you deal with Widgets, dispose() is not a method that gets called when it gets disposed, it is a method that users can programmatically invoke to dispose the widget. So the only way to know for sure that a Widget is disposed is through its disposed listener.

A viewer should dispose its resources when its associated Control is disposed.

Here it's extra confusing because the viewer is a TmfViewer which has its own dispose() method... So it has double purpose, its super should be called to release resource, but having the method called by a user could be used to trigger the disposal of the widget (this is not a normal use case but we are kind of forced to handle it because the viewer has a public dispose method...), which should be done by calling dispose() on the Control, which ultimately leads to the DisposeListener that should call super.dispose(). %^p

Line:72, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/views/LamiAxisListSelectionDialog.java -> Fair enough.

Line:161, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/views/LamiReportView.java -> OK :)

Line:57, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/views/LamiReportViewFactory.java -> Maybe there is some other API on the Platform UI that we can use to active the desired view that doesn't screw up the Project Explorer internal state? Need to experiment...

Line:60, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/views/LamiReportViewFactory.java -> If it's the same instance of the report, it would be nice to be smart about it...

Line:113, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/views/LamiViewerControl.java -> OK, agree. This is not a Control in the SWT sense, but an object that is created and disposed during the lifespan of its parent view.

File Comment: lttng/org.eclipse.tracecompass.lttng2.kernel.core/src/org/eclipse/tracecompass/internal/lttng2/kernel/core/analysis/ondemand/lttnganalyses/LttngCpuTopAnalysis.java -> You might want to protect the chart against any x-series label that resolves to an empty string, though.
Line:89, tmf/org.eclipse.tracecompass.tmf.ui/src/org/eclipse/tracecompass/tmf/ui/project/model/TmfReportsElement.java -> int i = 1;
while (fCurrentReports.containsKey(reportDisplayName)) {
    i++;
    reportDisplayName = report.getName() + " #" + i; //$NON-NLS-1$
}

----------------------------------------------------------------------------------------------------------------------
Author: Alexandre Montplaisir
Date: 2016-04-28 22:33:20.000000000
Message: 
Patch Set 2:

(4 comments)
Line:120, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/viewers/LamiScatterViewer.java -> > Could be Math.max with a floor constant?

Yeah that's be simpler/cleaner.

You kind of have to have a minimal limit with log scales, because you cannot print 0 (log(0) = -inf). We tried with different values and 0.9 was the most good (or least bad) looking.

> Or just not plotted?

That's what will happen now, a value of 0.8 would not appear on the chart.

Line:124, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/viewers/LamiScatterViewer.java -> Maybe null does make sense for numerical results. We would have to precise that on the analysis side first.

If it turns out that nulls are valid (they probably are), then yeah we should skip plotting the entries where we don't have both the X and Y.

Line:60, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/views/LamiReportViewFactory.java -> You may want to open the exact same report twice: you could setup some charts in the first, and different charts in the other. Or show different tabs (upcoming) at the same time. At least that's what we had in mind.

Line:89, tmf/org.eclipse.tracecompass.tmf.ui/src/org/eclipse/tracecompass/tmf/ui/project/model/TmfReportsElement.java -> ok that looks good!

----------------------------------------------------------------------------------------------------------------------
Author: Jonathan Rajotte Julien
Date: 2016-04-28 22:50:51.000000000
Message: 
Patch Set 2:

(2 comments)
Line:82, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/viewers/LamiHistogramViewer.java -> >I don't see how it would be false information if the count per >process would be the sum of the count of all its threads.

You don't have guarantee that it is the same process and its thread. I could launch multiple bash and still it is not the same process but the same name.

> In any case, if there's no aggregation of buckets or any
> assurance that the y-values are counts, it seems this viewer > is rather just a 'bar chart' viewer. Whether it represents an > histogram depends entirely on the analysis and the chosen > series.

Yup we should absolutely go with bar chart since the bucket part / aggregation part is done by the analyse.

Good catch.

Line:220, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/viewers/LamiHistogramViewer.java -> I'll live with the null check since events could be triggered from anywhere and since the default do no specify NonNull it could be null even if "the platform" might never do it.

Simply playing by the rules.

----------------------------------------------------------------------------------------------------------------------
Author: Patrick Tasse
Date: 2016-04-28 23:31:44.000000000
Message: 
Patch Set 2:

(4 comments)
Line:82, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/viewers/LamiHistogramViewer.java -> > You don't have guarantee that it is the same process and its thread. I could launch multiple bash and still it is not the same process but the same name.

Well it could have been OK if what I want is the system call count per process name (no matter the PID).

But anyways it's fine, the discussion is moot and anyways if that's what I want I can just make an LTTng-Analysis script for specifically that, right ;)

Line:220, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/viewers/LamiHistogramViewer.java -> Yup, pretty much the whole SWT library is implicitly non null unless stated otherwise, which doesn't blend well with null annotations...

Line:120, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/viewers/LamiScatterViewer.java -> The ideal would be to filter them out and let SWTChart figure out the optimal log scale for the y-axis. But otherwise you could achieve it yourself by using the minimum non-zero value for the y-axis range, and then map <= 0 to anything smaller than that (e.g. min/10) if you want it to be out-of-range.

Line:60, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/views/LamiReportViewFactory.java -> OK, I didn't think of that use case. It could have been (or could be later) achieved by having a UI way to split-out a chart from the current view and duplicating it.

Because now if a report has 5 views and you want to setup different charts for a single one, you have to duplicate all 5 views.

Anyways it's fine for now, there will be opportunities for you to improve this later.

----------------------------------------------------------------------------------------------------------------------
Author: Alexandre Montplaisir
Date: 2016-05-04 20:27:31.000000000
Message: 
Patch Set 2:

(6 comments)
Line:29, analysis/org.eclipse.tracecompass.analysis.lami.core/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/core/types/LamiBoolean.java -> Even true/false would have to be localized.

It's to show in table cells, I think yes/no is slightly more user-friendly, true/false is programmer jargon. But I wouldn't mind either alternative.

Line:82, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/handler/DeleteReportHandler.java -> Ok I've ported these handlers to HandlerUtil, wow, they're much simpler now!

Line:2, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/handler/ParameterDialog.java -> s/MessageDialog/InputDialog

Line:220, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/viewers/LamiHistogramViewer.java -> The *real* fix would be for SWT to use null annotations too!

The second-best, and more realistic fix, is to add external annotations to library methods we know always return non-null. Doing so would then start warning us when we do null-checks that we don't need!

Line:169, analysis/org.eclipse.tracecompass.analysis.lami.ui/src/org/eclipse/tracecompass/internal/provisional/analysis/lami/ui/viewers/LamiXYChartViewer.java -> The legend goes at the bottom when there is more than one series now.

Line:46, lttng/org.eclipse.tracecompass.lttng2.kernel.core/plugin.xml -> This goes away completely, it's properties files all the way down now.

----------------------------------------------------------------------------------------------------------------------
Author: Alexandre Montplaisir
Date: 2016-05-04 21:43:30.000000000
Message: 
Abandoned

Replaced by https://git.eclipse.org/r/#/c/71565/ and surrounding patches.
----------------------------------------------------------------------------------------------------------------------
