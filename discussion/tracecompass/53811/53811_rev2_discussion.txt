======================================================================================================================
DESCRIPTION:

[CTF] Events wrongly parsed as Lost Events

In CTFStreamInputPacketReader, setCurrentPacket can be called multiple times
without necessarily calling readNextEvent, which means that the cached value
for fHasLost can be wrong the next time readNextEvent is called.

Bug: 475007
Change-Id: I36c22c22c144cb8307403f93c76c996c60ff52aa
Signed-off-by: Marc-Andre Laperle <marc-andre.laperle@ericsson.com>

======================================================================================================================
COMMENTS
======================================================================================================================
Author: Marc-André Laperle
Date: 2015-08-17 04:33:55.000000000
Message: 
Uploaded patch set 2: Patch Set 1 was rebased.
----------------------------------------------------------------------------------------------------------------------
Author: CI Bot
Date: 2015-08-17 04:34:02.000000000
Message: 
Patch Set 2:

Build Started https://hudson.eclipse.org/tracecompass/job/tracecompass-gerrit/3500/
----------------------------------------------------------------------------------------------------------------------
Author: CI Bot
Date: 2015-08-17 05:05:23.000000000
Message: 
Patch Set 2: Code-Review+1

Build Successful 

https://hudson.eclipse.org/tracecompass/job/tracecompass-gerrit/3500/ : SUCCESS
----------------------------------------------------------------------------------------------------------------------
Author: Matthew Khouzam
Date: 2015-08-17 21:42:35.000000000
Message: 
Patch Set 2: Code-Review+2

This is a great catch. Let's discuss the test later, but the code looks good to me.
----------------------------------------------------------------------------------------------------------------------
Author: Marc-André Laperle
Date: 2015-08-18 22:26:36.000000000
Message: 
Patch Set 2: Code-Review+2 Verified+1

Just for the record:

Matthew and I verified the expected number of events and lost events the best we could. We cannot use Babeltrace to verify since this trace is not supported (yet?) by it. We deduced the totals by considering 100000 events generated by increment (0 to 99999), one different event at the beginning, two at end end. We examined the last events in the stream opened with a binary editor. There is also 1 lost event (containing 1000 lost events). There was an invalid lost event containing 0 lost events, which is what this bug fixes.

The test passes and I also verified that my large local trace now behaves properly with this fix.
----------------------------------------------------------------------------------------------------------------------
Author: Gerrit Code Review
Date: 2015-08-18 22:49:03.000000000
Message: 
Change has been successfully cherry-picked as dd7f18790ea50e1c5e8167845fe53e3ec5ff648a by Marc-Andre Laperle
----------------------------------------------------------------------------------------------------------------------
