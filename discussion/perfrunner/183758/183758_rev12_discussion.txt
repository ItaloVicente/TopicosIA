======================================================================================================================
DESCRIPTION:

Add script to collect prometheus metrics for DN + DAPI nodes

Change-Id: I499e168b5e7105f49154cfb61425e21c0c582745

======================================================================================================================
COMMENTS
======================================================================================================================
Author: Daniel Nagy
Date: 2022-12-13 10:55:18.000000000
Message: 
Uploaded patch set 12.
----------------------------------------------------------------------------------------------------------------------
Author: Build Bot
Date: 2022-12-13 10:56:55.000000000
Message: 
Patch Set 12:

Build Started http://perf.jenkins.couchbase.com/job/gerrit_perfrunner/19850/
----------------------------------------------------------------------------------------------------------------------
Author: Build Bot
Date: 2022-12-13 10:58:39.000000000
Message: 
Patch Set 12: Verified+1

Build Successful 

http://perf.jenkins.couchbase.com/job/gerrit_perfrunner/19850/ : SUCCESS
----------------------------------------------------------------------------------------------------------------------
Author: vikas chaudhary
Date: 2023-01-24 11:41:55.000000000
Message: 
Patch Set 12: Code-Review+1
----------------------------------------------------------------------------------------------------------------------
Author: Laura Silaja
Date: 2023-01-24 15:43:31.000000000
Message: 
Patch Set 12:

(3 comments)
Line:38, perfrunner/utils/nebula_metrics.py -> Why are you using with statement here?

Line:79, perfrunner/utils/nebula_metrics.py -> Why are you just specifying the return type here?

Line:88, perfrunner/utils/nebula_metrics.py -> which part does the waiting?

----------------------------------------------------------------------------------------------------------------------
Author: Daniel Nagy
Date: 2023-01-24 17:12:02.000000000
Message: 
Patch Set 12:

(3 comments)
Line:38, perfrunner/utils/nebula_metrics.py -> When you do `stream=True` for requests library requests, the underlying TCP connection cannot be released until you consume all the data (you stream it all) or you explicitly close the connection.

Using the with statement ensures that the connection is released regardless of whether all the data is consumed or not.

See https://requests.readthedocs.io/en/latest/user/advanced/#body-content-workflow

Line:79, perfrunner/utils/nebula_metrics.py -> Because this was the only function that returned something.

I guess I can just do -> None for all the rest. I'm not actually sure of the guidelines here.

Line:88, perfrunner/utils/nebula_metrics.py -> the `portforward.stdout.readline()` 

This will return the next line of stdout that is generated by the process represented in the Popen object called portforward.

If there is data in stdout ready to return, it will return immediately. But if there is nothing in stdout yet, it will wait until there is something to return

----------------------------------------------------------------------------------------------------------------------
Author: Laura Silaja
Date: 2023-01-24 18:16:53.000000000
Message: 
Patch Set 12:

(3 comments)
Line:38, perfrunner/utils/nebula_metrics.py -> Thanks for explaining and the doc information.

Line:79, perfrunner/utils/nebula_metrics.py -> Doesn't update_kubeconfig return the returncode? It's the above function. The bellow function also returns values. I wasn't quite sure what style you were going for. Even if you don't choose the best style it should be at least consistent. You either label all functions, none of them or all the return functions only.

Honestly, Perfrunner is bit all over the place with regards to this. Even in the same file. For example in the settings.py you can see them not putting any return type hints and in other places in the same file have the return -> None type hints. This is a style guideline that the team should agree to together and stick to it.

Line:88, perfrunner/utils/nebula_metrics.py -> I see, that makes sense to me. I was just double checking with you that the line actually does the wait in the case you specified or if you just forgot to add it.

----------------------------------------------------------------------------------------------------------------------
Author: Daniel Nagy
Date: 2023-01-26 09:48:39.000000000
MISMATCHED INLINE COMMENT
Line:38, perfrunner/utils/nebula_metrics.py -> Done
----------------------------------------------------------------------------------------------------------------------
Author: Daniel Nagy
Date: 2023-01-26 09:48:39.000000000
MISMATCHED INLINE COMMENT
Line:79, perfrunner/utils/nebula_metrics.py -> Ah yeah whoops I'm blind - update_kubeconfig does indeed return an int. I have no excuses there, good catch
----------------------------------------------------------------------------------------------------------------------
Author: Daniel Nagy
Date: 2023-01-26 09:48:39.000000000
MISMATCHED INLINE COMMENT
Line:88, perfrunner/utils/nebula_metrics.py -> Done
----------------------------------------------------------------------------------------------------------------------
