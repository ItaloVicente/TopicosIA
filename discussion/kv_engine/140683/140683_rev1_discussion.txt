======================================================================================================================
DESCRIPTION:

MB-42864: Ensure Connection::remapErrorCode returns v7 dcp status codes

Currently Connection::remapErrorCode() remaps ENGINE_STREAM_NOT_FOUND
and ENGINE_OPAQUE_NO_MATCH to ENGINE_DISCONNECT. This is incorrect,
these status codes do not need to be remapped and should just be
returned by Connection::remapErrorCode().

Change-Id: Ia0c83c6c1781f5d84c40e75aabec7900f95e5403

======================================================================================================================
COMMENTS
======================================================================================================================
Author: Richard de Mellow
Date: 2020-11-20 10:00:11.000000000
Message: 
Uploaded patch set 1.
----------------------------------------------------------------------------------------------------------------------
Author: Richard de Mellow
Date: 2020-11-20 10:12:16.000000000
Message: 
Removed reviewer Trond Norbye.
----------------------------------------------------------------------------------------------------------------------
Author: Richard de Mellow
Date: 2020-11-20 10:12:18.000000000
Message: 
Removed reviewer Dave Rigby.
----------------------------------------------------------------------------------------------------------------------
Author: Richard de Mellow
Date: 2020-11-20 10:12:19.000000000
Message: 
Removed reviewer Jim Walker.
----------------------------------------------------------------------------------------------------------------------
Author: Richard de Mellow
Date: 2020-11-20 10:12:20.000000000
Message: 
Removed reviewer Daniel Owen.
----------------------------------------------------------------------------------------------------------------------
Author: Richard de Mellow
Date: 2020-11-20 10:12:21.000000000
Message: 
Removed reviewer Dave Finlay.
----------------------------------------------------------------------------------------------------------------------
Author: Richard de Mellow
Date: 2020-11-20 10:12:22.000000000
Message: 
Removed reviewer James Harrison.
----------------------------------------------------------------------------------------------------------------------
Author: Richard de Mellow
Date: 2020-11-20 10:12:24.000000000
Message: 
Removed reviewer Paolo Cocchi.
----------------------------------------------------------------------------------------------------------------------
Author: Richard de Mellow
Date: 2020-11-20 10:12:25.000000000
Message: 
Removed reviewer Ben Huddleston.
----------------------------------------------------------------------------------------------------------------------
Author: Build Bot
Date: 2020-11-20 10:31:32.000000000
Message: 
Patch Set 1: Verified+1

Build Successful 

http://cv.jenkins.couchbase.com/job/kv_engine-clang_format_9/4301/ : SUCCESS

http://cv.jenkins.couchbase.com/job/kv_engine-windows-master/31937/ : SUCCESS

http://cv.jenkins.couchbase.com/job/kv_engine-clang_analyzer-master/27564/ : SUCCESS

http://cv.jenkins.couchbase.com/job/kv_engine-clang_tidy/5769/ : SUCCESS

http://cv.jenkins.couchbase.com/job/kv_engine.linux-CE/job/master/7187/ : SUCCESS

http://cv.jenkins.couchbase.com/job/kv_engine.linux/job/master/7311/ : SUCCESS

http://cv.jenkins.couchbase.com/job/kv_engine.ASan-UBSan/job/master/15119/ : SUCCESS

http://cv.jenkins.couchbase.com/job/kv_engine.macos/job/master/6265/ : SUCCESS

http://cv.jenkins.couchbase.com/job/kv_engine.threadsanitizer/job/master/7548/ : SUCCESS
----------------------------------------------------------------------------------------------------------------------
Author: Jim Walker
Date: 2020-11-20 10:46:01.000000000
Message: 
Patch Set 1: Code-Review-1

(1 comment)
Line:299, daemon/connection.cc -> don't we still need to remap it if the client hasn't enabled xerror or check the connection capabiilty? e.g. collections returns UNKNOWN_SCOPE of isCollectionsSupported else maps to EINVAL

----------------------------------------------------------------------------------------------------------------------
Author: Jim Walker
Date: 2020-11-20 10:47:11.000000000
Message: 
Patch Set 1:

(1 comment)
Line:299, daemon/connection.cc -> or do we need to comment here to say that this error code is only generated by the producer/stream when we know the client has turned this feature on?

----------------------------------------------------------------------------------------------------------------------
Author: Richard de Mellow
Date: 2020-11-20 10:52:23.000000000
Message: 
Patch Set 1:

(1 comment)
Line:299, daemon/connection.cc -> The codes are enabled per DCP connection, so not 100% sure we have the context here to work out if there enabled. Also inline with the your second comment, we only ever return the status codes from the DcpConsumer when the consumer has enabled them using a control message. So I'll add a code comment about it :).

----------------------------------------------------------------------------------------------------------------------
