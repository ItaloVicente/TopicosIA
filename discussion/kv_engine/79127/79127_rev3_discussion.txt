======================================================================================================================
DESCRIPTION:

MB-24432: Store a seqno to _local to determine when a CAS is a HLC value

Add a new field to _local/vbstate called hlc_epoch, this is a seqno
which we will later use to determine if a value has a CAS that is
a HLC (as opposed to a CAS generated in 3.x).

This persisted seqno will be used in the future to determine which
items can be tagged with a last-update virtual xattr (i.e. items we
know that the CAS is HLC generated as opposed to a CAS generated by
3.x).

Change-Id: I5ef5a8a08b06e69e3160ed71524f74c3053fd59e

======================================================================================================================
COMMENTS
======================================================================================================================
Author: Jim Walker
Date: 2017-06-07 09:37:53.000000000
Message: 
Patch Set 3: Patch Set 2 was rebased
----------------------------------------------------------------------------------------------------------------------
Author: Build Bot
Date: 2017-06-07 10:02:55.000000000
Message: 
Patch Set 3: Verified+1

Build Successful 

http://cv.jenkins.couchbase.com/job/kv_engine-linux-master/314/ : SUCCESS

http://cv.jenkins.couchbase.com/job/kv_engine-threadsanitizer-master/358/ : SUCCESS

http://cv.jenkins.couchbase.com/job/kv_engine-addresssanitizer-master/361/ : SUCCESS

http://cv.jenkins.couchbase.com/job/kv_engine-clang_analyzer-master/315/ : SUCCESS

http://cv.jenkins.couchbase.com/job/kv_engine-windows-master/326/ : SUCCESS
----------------------------------------------------------------------------------------------------------------------
Author: Dave Rigby
Date: 2017-06-07 10:12:36.000000000
Message: 
Patch Set 3: Code-Review-1

(5 comments)

Would also be good to test warmup's handling of HLC epoch - esp in the case of upgrading from <spock.
Line:2151, engines/ep/src/couch-kvstore/couch-kvstore.cc -> Style - nicer to use string::empty()

Line:2152, engines/ep/src/couch-kvstore/couch-kvstore.cc -> If there's no hlcCasEpoch field, then I assume that means this is a pre-Spock vbstate; and as such we don't know what the HLC epoch is. Would a non-zero value (e.g. -1) be clearer? - given that with zero we'll always have to ensure we check if it's zero and special-case; whereas if it's -1 then we will always be "before" the HLC epoch (once we figure it out).

Line:153, engines/ep/src/kvstore.h -> I think you might actually be able to delete this and just use the compiler-generated (given it doesn't do anything special).

Line:197, engines/ep/src/vbucket.cc -> As previous; might be safer to init to -1.

Line:1202, engines/ep/src/vbucket.h -> Probably worth a brief comment documenting these.

----------------------------------------------------------------------------------------------------------------------
Author: Jim Walker
Date: 2017-06-14 11:56:33.000000000
MISMATCHED INLINE COMMENT
Line:153, engines/ep/src/kvstore.h -> Done
----------------------------------------------------------------------------------------------------------------------
