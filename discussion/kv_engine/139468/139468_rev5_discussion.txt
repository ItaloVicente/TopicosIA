======================================================================================================================
DESCRIPTION:

MB-42352: allow_del_with_meta_prune_user_data true by default

Pre-6.6 versions are affected by invalid payloads generated by
expirations. Ie, body or user-xattrs in the value.
6.6.0 fixes that. But, users of DelWithMeta may still fail validation
when they want to store pre-6.6 data into a 6.6 node. Eg,
backup/restore and XDCR.

Since MB-36321 DelWithMeta can operate in a "sanitizer" mode that is off
by default. This patch enables it, so any invalid payload will be
sanitized and successfully stored in 6.6.

The feature seems to have already a decent test coverage, introduced in
http://review.couchbase.org/c/kv_engine/+/115904/ first and then
expanded in http://review.couchbase.org/c/kv_engine/+/129191.

Change-Id: I3e436bafd98d4eec9d91f34c5d45be882440d57e

======================================================================================================================
COMMENTS
======================================================================================================================
Author: Paolo Cocchi
Date: 2020-11-05 09:46:05.000000000
Message: 
Patch Set 5: Patch Set 4 was rebased
----------------------------------------------------------------------------------------------------------------------
Author: Build Bot
Date: 2020-11-05 09:46:14.000000000
Message: 
Patch Set 5:

Permission granted to commit: 

http://server.jenkins.couchbase.com/job/restricted-branch-check/208387/artifact/restricted.html : SUCCESS
----------------------------------------------------------------------------------------------------------------------
Author: Build Bot
Date: 2020-11-05 10:12:30.000000000
Message: 
Patch Set 5: Verified-1

Build Failed 

http://cv.jenkins.couchbase.com/job/kv_engine-windows-madhatter/1746/ : FAILURE

Failure of an engine_testapp test:

<pre>
Running [0000/0157]: expiry pager settings (couchstore).....\kv_engine\engines\ep\tests\ep_testsuite.cc:716 Test failed: `" (Expected `2020-11-05 10:25:04" to be less than or equal to `2020-11-05 10:25:03" - Unexpected task time range, expect: 2020-11-05 10:25:04 <= 2020-11-05 10:25:03 <= 2020-11-05 10:25:04)
(2127 ms) FAIL
</pre>
 ( http://cv.jenkins.couchbase.com/job/kv_engine-windows-madhatter/1746/ )

Failure of GoogleTest "DurabilityTest.Set":

<pre>
[ RUN      ] DurabilityTest.Set
unknown file: error: SEH exception with code 0xc0000005 thrown in the test body.
[  FAILED  ] DurabilityTest.Set (0 ms)
DurabilityTest.Set
</pre>
 ( http://cv.jenkins.couchbase.com/job/kv_engine-windows-madhatter/1746/ )

Failure of a CTest test  31/181 Test  #26: ep_testsuite.value_eviction.comp_active ...................................... ( http://cv.jenkins.couchbase.com/job/kv_engine-windows-madhatter/1746/ )

http://cv.jenkins.couchbase.com/job/kv_engine.threadsanitizer/job/mad-hatter/1467/ : FAILURE

Failure of a CTest test [2020-11-05T10:04:34.607Z]   5/184 Test  #49: ep_testsuite_xdcr.value_eviction.comp_passive ................................ ( http://cv.jenkins.couchbase.com/job/kv_engine.threadsanitizer/job/mad-hatter/1467/ )

http://cv.jenkins.couchbase.com/job/kv_engine-clang_format/26155/ : SUCCESS

http://cv.jenkins.couchbase.com/job/kv_engine-clang_analyzer-mad-hatter/1564/ : SUCCESS

http://cv.jenkins.couchbase.com/job/kv_engine.linux/job/mad-hatter/1687/ : SUCCESS

http://cv.jenkins.couchbase.com/job/kv_engine.linux-CE/job/mad-hatter/1691/ : SUCCESS

http://cv.jenkins.couchbase.com/job/kv_engine.ASan-UBSan/job/mad-hatter/1660/ : SUCCESS

http://cv.jenkins.couchbase.com/job/kv_engine.macos/job/mad-hatter/1028/ : SUCCESS
----------------------------------------------------------------------------------------------------------------------
Author: Build Bot
Date: 2020-11-05 11:32:48.000000000
Message: 
Patch Set 5:

Build Failed 

http://cv.jenkins.couchbase.com/job/kv_engine-windows-madhatter/1748/ : FAILURE

Failure of GoogleTest "TransportProtocols/WithMetaTest.basicSet/Mcbp_XattrYes_JsonYes_SnappyYes":

<pre>
[ RUN      ] TransportProtocols/WithMetaTest.basicSet/Mcbp_XattrYes_JsonYes_SnappyYes
unknown file: error: C++ exception with description "create_connect_plain_socket: Can"t connect to port == -1" thrown in SetUp().
[  FAILED  ] TransportProtocols/WithMetaTest.basicSet/Mcbp_XattrYes_JsonYes_SnappyYes, where GetParam() = (Mcbp, XattrYes, 4-byte object <00-00 00-00>, 4-byte object <00-00 00-00>) (0 ms)
TransportProtocols/WithMetaTest.basicSet/Mcbp_XattrYes_JsonYes_SnappyYes
</pre>
 ( http://cv.jenkins.couchbase.com/job/kv_engine-windows-madhatter/1748/ )

Failure of a CTest test 167/181 Test #171: memcached_testapp.ep.TransportProtocols/WithMetaTest ......................... ( http://cv.jenkins.couchbase.com/job/kv_engine-windows-madhatter/1748/ )

http://cv.jenkins.couchbase.com/job/kv_engine-clang_format/26155/ : SUCCESS

http://cv.jenkins.couchbase.com/job/kv_engine-clang_analyzer-mad-hatter/1564/ : SUCCESS

http://cv.jenkins.couchbase.com/job/kv_engine.linux/job/mad-hatter/1687/ : SUCCESS

http://cv.jenkins.couchbase.com/job/kv_engine.linux-CE/job/mad-hatter/1691/ : SUCCESS

http://cv.jenkins.couchbase.com/job/kv_engine.ASan-UBSan/job/mad-hatter/1660/ : SUCCESS

http://cv.jenkins.couchbase.com/job/kv_engine.macos/job/mad-hatter/1028/ : SUCCESS

http://cv.jenkins.couchbase.com/job/kv_engine.threadsanitizer/job/mad-hatter/1470/ : SUCCESS
----------------------------------------------------------------------------------------------------------------------
Author: Dave Rigby
Date: 2020-11-05 11:34:36.000000000
Message: 
Patch Set 5: Code-Review+2
----------------------------------------------------------------------------------------------------------------------
Author: Build Bot
Date: 2020-11-05 11:45:01.000000000
Message: 
Patch Set 5: Verified+1

Build Successful 

http://cv.jenkins.couchbase.com/job/kv_engine-clang_format/26155/ : SUCCESS

http://cv.jenkins.couchbase.com/job/kv_engine-clang_analyzer-mad-hatter/1564/ : SUCCESS

http://cv.jenkins.couchbase.com/job/kv_engine.linux/job/mad-hatter/1687/ : SUCCESS

http://cv.jenkins.couchbase.com/job/kv_engine.linux-CE/job/mad-hatter/1691/ : SUCCESS

http://cv.jenkins.couchbase.com/job/kv_engine.ASan-UBSan/job/mad-hatter/1660/ : SUCCESS

http://cv.jenkins.couchbase.com/job/kv_engine.macos/job/mad-hatter/1028/ : SUCCESS

http://cv.jenkins.couchbase.com/job/kv_engine.threadsanitizer/job/mad-hatter/1470/ : SUCCESS

http://cv.jenkins.couchbase.com/job/kv_engine-windows-madhatter/1749/ : SUCCESS
----------------------------------------------------------------------------------------------------------------------
