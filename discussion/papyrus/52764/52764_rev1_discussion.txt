======================================================================================================================
DESCRIPTION:

Bug 473188: [CSS3] Papyrus should provide a formatter for CSS3
https://bugs.eclipse.org/bugs/show_bug.cgi?id=473188

Manage the CSS formatter.

Change-Id: Ib3996df6f805faf2752e95be5c532502181d8294
Signed-off-by: Nicolas FAUVERGUE <nicolas.fauvergue@all4tec.net>

======================================================================================================================
COMMENTS
======================================================================================================================
Author: Nicolas FAUVERGUE
Date: 2015-07-29 07:42:23.000000000
Message: 
Uploaded patch set 1.
----------------------------------------------------------------------------------------------------------------------
Author: CI Bot
Date: 2015-07-29 08:25:30.000000000
Message: 
Patch Set 1:

Build Started https://hudson.eclipse.org/papyrus/job/Papyrus-Gerrit/4215/
----------------------------------------------------------------------------------------------------------------------
Author: CI Bot
Date: 2015-07-29 09:05:34.000000000
Message: 
Patch Set 1: Verified+1

Build Successful 

https://hudson.eclipse.org/papyrus/job/Papyrus-Gerrit/4215/ : SUCCESS
----------------------------------------------------------------------------------------------------------------------
Author: Shuai Li
Date: 2015-07-29 15:02:14.000000000
Message: 
Patch Set 1:

(3 comments)

Here are my comments.
Line:3, plugins/infra/gmfdiag/css/org.eclipse.papyrus.infra.gmfdiag.css3.xtext/src/org/eclipse/papyrus/infra/gmfdiag/css3/CSSRuntimeModule.java -> Copyright instead of this

Line:9, plugins/infra/gmfdiag/css/org.eclipse.papyrus.infra.gmfdiag.css3.xtext/src/org/eclipse/papyrus/infra/gmfdiag/css3/CSSRuntimeModule.java -> Should we leave an empty class?

File Comment: plugins/infra/gmfdiag/css/org.eclipse.papyrus.infra.gmfdiag.css3.xtext/src/org/eclipse/papyrus/infra/gmfdiag/css3/formatting/CSSFormatter.xtend -> My test case is a simple model with 1 Class + 1 Operation shown in a Class Diagram. I changed the fill color of the Class in the Appearance tab. Then: Right-click on the Class > Format > Create a new style > Stylesheet > Browser workspace > Select my stylesheet that I created beforehand

I get the CSS below:

Class { fontName:"Segoe UI" ; fillColor:#E4B3E5 ; transparency:0.0 ;
gradient:#FFFFFF vertical ; lineColor:#000000 }

I think it should be formatted like this:

Class {
  fontName: "Segoe UI";
  fillColor: #E4B3E5;
  transparency: 0.0;
  gradient: #FFFFFF vertical;
  lineColor: #000000;
}

Note the extra space before ";" was removed and a space is added after ":". Furthermore the last property value should end with a ";".
----------------------------------------------------------------------------------------------------------------------
Author: Nicolas FAUVERGUE
Date: 2015-07-29 16:20:47.000000000
Message: 
Patch Set 1:

(3 comments)

Somme comments to reply
Line:3, plugins/infra/gmfdiag/css/org.eclipse.papyrus.infra.gmfdiag.css3.xtext/src/org/eclipse/papyrus/infra/gmfdiag/css3/CSSRuntimeModule.java -> This class is generated by XText document.
We can't use the copyright.

Line:9, plugins/infra/gmfdiag/css/org.eclipse.papyrus.infra.gmfdiag.css3.xtext/src/org/eclipse/papyrus/infra/gmfdiag/css3/CSSRuntimeModule.java -> This class is generated by XText document.
Futhermore, the parent class is abstract so we need an implementation of this.

File Comment: plugins/infra/gmfdiag/css/org.eclipse.papyrus.infra.gmfdiag.css3.xtext/src/org/eclipse/papyrus/infra/gmfdiag/css3/formatting/CSSFormatter.xtend -> This use case works successfully.
Did you build the "oep.infra.gmfdiag.css3.xtext" plugin to generate the correct classes corresponding to the xtend ?

Indeed, ';' is missing at the end of the last property. This problem is not related to this bug (maybe we need to open an other bug on bugzilla). If the ';' is added manually and a format (CTRL + SHIFT + F) is done after this, all works fine.
----------------------------------------------------------------------------------------------------------------------
Author: Shuai Li
Date: 2015-07-30 13:13:48.000000000
Message: 
Patch Set 1:

(1 comment)
File Comment: plugins/infra/gmfdiag/css/org.eclipse.papyrus.infra.gmfdiag.css3.xtext/src/org/eclipse/papyrus/infra/gmfdiag/css3/formatting/CSSFormatter.xtend -> I guess it was a problem with my old M6 installation. In Mars release it works.

I get something like this:

Class {
	fontName:"Segoe UI";
	fillColor:#E4B3E5;
	transparency:0.0;
	gradient:#FFFFFF vertical;
	lineColor:#000000 }

Is it possible to have the closing bracket at a new line, and a space after ":"? E.g.

Class {
	fontName: "Segoe UI";
	fillColor: #E4B3E5;
	transparency: 0.0;
	gradient: #FFFFFF vertical;
	lineColor: #000000
}

After that I have no more issues with the patch. You are right that CSS generation bugs are not related to this formatting bug.
----------------------------------------------------------------------------------------------------------------------
Author: Nicolas FAUVERGUE
Date: 2015-07-30 14:34:14.000000000
Message: 
Patch Set 1:

(1 comment)
File Comment: plugins/infra/gmfdiag/css/org.eclipse.papyrus.infra.gmfdiag.css3.xtext/src/org/eclipse/papyrus/infra/gmfdiag/css3/formatting/CSSFormatter.xtend -> "Is it possible to have the closing bracket at a new line,"

For the new line, when the bug of ';' was resolved, the problem not occured anymore. If i add a linewrap before the '}' token, an empty line will appear when the last property get ';'.


"and a space after ":"? E.g."

Indded, the space after the colon was already implement (line 141).
It seems it does not work but some others implementations do not work too, for example :

c.setSpace(SPACE).before(css_declarationAccess.valueTokensAssignment_4);

or

c.setSpace(SPACE).before(cssTokRule);

I think it does not work because of the WSTok rule (maybe conflit with the setSpace() and the rule).
----------------------------------------------------------------------------------------------------------------------
Author: Shuai Li
Date: 2015-07-30 15:56:48.000000000
Message: 
Patch Set 1: Code-Review+1

(1 comment)
File Comment: plugins/infra/gmfdiag/css/org.eclipse.papyrus.infra.gmfdiag.css3.xtext/src/org/eclipse/papyrus/infra/gmfdiag/css3/formatting/CSSFormatter.xtend -> Okay, the patch is fine for me. I will ask someone to push to master.
----------------------------------------------------------------------------------------------------------------------
Author: Benoit Maggi
Date: 2015-08-03 06:56:03.000000000
Message: 
Patch Set 1: Code-Review+2
----------------------------------------------------------------------------------------------------------------------
Author: Benoit Maggi
Date: 2015-08-03 06:56:05.000000000
Message: 
Patch Set 2: Patch Set 1 was rebased
----------------------------------------------------------------------------------------------------------------------
Author: Gerrit Code Review
Date: 2015-08-03 06:56:08.000000000
Message: 
Change has been successfully rebased as 2805078d2f7a817d1751d194a683d42e96afcfcd by Benoit Maggi
----------------------------------------------------------------------------------------------------------------------
